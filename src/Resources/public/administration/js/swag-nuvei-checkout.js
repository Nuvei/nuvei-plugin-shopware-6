'use strict';function runNuveiScripts(){console.log("runNuveiScripts");if(0>window.location.toString().search("/order/detail/"))console.log("Not Orders details page. Stop Nuvei process");else{var d=new XMLHttpRequest;d.onreadystatechange=function(){if(d.readyState==XMLHttpRequest.DONE)if(200==d.status){var g=JSON.parse(d.response);console.log("status == 200",g);g.hasOwnProperty("success")&&1==g.success?(nuveiBuildButtons(g),nuveiSetEvents(g),nuveiBuildNotes(g)):g.hasOwnProperty("message")&&""!=g.message?
alert(g.message):alert("Nuvei Ajax call unexpected error. Please, refresh the page!")}else 400==d.status?console.log("There was an error 400."):alert("Nuvei Ajax call unexpected error. Please, refresh the page!")};d.open("GET","/api/nuvei/check_order/?hash="+window.location.hash.replace("#",""),!0);d.send()}}
function nuveiBuildButtons(d){let g=document.getElementsByClassName("sw-order-state-card")[0],f=document.createElement("div");f.setAttribute("id","nuveiActions");var b=document.createElement("div");b.setAttribute("class","sw-card has--header has--title");f.appendChild(b);var a=document.createElement("div");a.setAttribute("class","sw-card__header");b.appendChild(a);var c=document.createElement("div");c.setAttribute("class","sw-card__titles");a.appendChild(c);var e=document.createElement("img");e.src=
"/bundles/swagnuveicheckout/storefront/img/rolling.gif";e.width=20;e.style.display="none";e.setAttribute("id","nuveiLoader");a.appendChild(e);a=document.createElement("div");a.setAttribute("class","sw-card__title");a.innerHTML="Nuvei Actions for the Order";c.appendChild(a);c=document.createElement("div");c.setAttribute("class","sw-card__content");b.appendChild(c);b=document.createElement("div");b.setAttribute("class","sw-container");b.style.display="block";c.appendChild(b);c=document.createElement("span");
c.setAttribute("class","sw-button__content");d.hasOwnProperty("canRefund")&&!0===d.canRefund&&(a=document.createElement("button"),a.setAttribute("class","sw-button sw-button--primary nuveiButton"),a.setAttribute("id","nuveiRefundBtn"),a.setAttribute("type","button"),a.style.marginRight="5px",e=c.cloneNode(!0),e.innerHTML="Refund",a.appendChild(e),b.appendChild(a));d.hasOwnProperty("canSettle")&&!0===d.canSettle&&(a=document.createElement("button"),a.setAttribute("class","sw-button sw-button--primary nuveiButton"),
a.setAttribute("id","nuveiSettleBtn"),a.setAttribute("type","button"),a.style.marginRight="5px",e=c.cloneNode(!0),e.innerHTML="Settle",a.appendChild(e),b.appendChild(a));d.hasOwnProperty("canVoid")&&!0===d.canVoid&&(d=document.createElement("button"),d.setAttribute("class","sw-button sw-button--primary nuveiButton"),d.setAttribute("id","nuveiVoidBtn"),d.setAttribute("type","button"),d.style.marginRight="5px",c=c.cloneNode(!0),c.innerHTML="Void",d.appendChild(c),b.appendChild(d));g.parentElement.after(f)}
function nuveiBuildNotes(d){if(d.hasOwnProperty("notes")&&0!=d.notes.length){var g=document.getElementById("nuveiActions"),f=document.createElement("div");f.setAttribute("id","nuveiNotes");var b=document.createElement("div");b.setAttribute("class","sw-card has--header has--title");f.appendChild(b);var a=document.createElement("div");a.setAttribute("class","sw-card__header");b.appendChild(a);var c=document.createElement("div");c.setAttribute("class","sw-card__titles");a.appendChild(c);a=document.createElement("div");
a.setAttribute("class","sw-card__title");a.innerHTML="Nuvei Notes for the Order";c.appendChild(a);c=document.createElement("div");c.setAttribute("class","sw-card__content");b.appendChild(c);b=document.createElement("table");b.setAttribute("border",0);b.style.width="100%";a=document.createElement("tr");b.appendChild(a);var e=document.createElement("th");e.innerHTML="Date";e.style.width="150px";e.style.textAlign="left";a.appendChild(e);e=document.createElement("th");e.innerHTML="Note";e.style.textAlign=
"left";a.appendChild(e);for(var h in d.notes)a=document.createElement("tr"),e=document.createElement("td"),e.innerHTML=d.notes[h].date,e.style.verticalAlign="top",e.style.textAlign="left",a.appendChild(e),e=document.createElement("td"),e.innerHTML=d.notes[h].note,e.style.textAlign="left",a.appendChild(e),b.appendChild(a);c.appendChild(b);g.after(f)}}
function nuveiSetEvents(d){console.log("nuveiSetEvents()");let g=document.getElementById("nuveiRefundBtn"),f=document.getElementById("nuveiSettleBtn"),b=document.getElementById("nuveiVoidBtn");g&&g.addEventListener("click",function(){nuveiAction("refund",d.orderNumber)});f&&f.addEventListener("click",function(){nuveiAction("settle",d.orderNumber)});b&&b.addEventListener("click",function(){nuveiAction("void",d.orderNumber)})}
function nuveiAction(d,g){if(confirm("Are you sure you want to execute this action?")){console.log(d,g);document.getElementById("nuveiLoader").style.display="inline-block";for(var f=document.getElementsByClassName("nuveiButton"),b=0;b<f.length;b++)f[b].setAttribute("disabled",!0);var a=new XMLHttpRequest;a.onreadystatechange=function(){if(a.readyState==XMLHttpRequest.DONE)if(200==a.status){var c=JSON.parse(a.response);console.log("Nuvei response",c);if(c.hasOwnProperty("success")&&1==c.success)window.location.reload();
else{c.hasOwnProperty("message")&&""!=c.message?alert(c.message):alert("Unexpected error. Please, refresh the page and try again!");for(c=0;c<f.length;c++)f[c].removeAttribute("disabled");document.getElementById("nuveiLoader").style.display="none"}}else{alert("Unexpected error. Please, refresh the page and try again!");for(c=0;c<f.length;c++)f[c].removeAttribute("disabled");document.getElementById("nuveiLoader").style.display="none"}};a.open("GET","/api/nuvei/order_action?action="+d+"&order_number="+
g,!0);a.send()}}
function runNuveiOrderListScript(){console.log("runNuveiOrderListScript");if(0>window.location.toString().search("/order/index"))console.log("Not Orders list page. Stop Nuvei process");else{var d=document.querySelectorAll("td.sw-data-grid__cell--orderNumber div a"),g=[];for(let b in d)d[b].textContent&&g.push(Number.parseInt(d[b].textContent));console.log(g);var f=new XMLHttpRequest;f.onreadystatechange=function(){if(f.readyState==XMLHttpRequest.DONE&&200==f.status){var b=JSON.parse(f.response);console.log("Nuvei response",
b);if(b.hasOwnProperty("success")&&1==b.success&&b.hasOwnProperty("data")&&""!=b.data){b=JSON.parse(b.data);var a=document.querySelectorAll(".sw-order-list__content table tbody tr");for(let c in a)try{let e=Number.parseInt(a[c].querySelector("td.sw-data-grid__cell--orderNumber div a").textContent);0>b.indexOf(e)||(a[c].querySelector("td.sw-data-grid__cell--transactions-last\\(\\)-stateMachineState-name div").innerHTML+='<span class="sw-label sw-label--appearance-pill sw-label--danger">Fraud?</span>')}catch(e){}}else console.log("No Nuvei Fraud Orders.")}};
f.open("GET","/api/nuvei/get_orders_data?orders="+JSON.stringify(g),!0);f.send()}};
